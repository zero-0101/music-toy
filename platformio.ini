; Default environment: switch to esp32-s2-saola-1
[platformio]
default_envs = esp32-s2-saola-1

[env:esp32-s2-saola-1]
platform = espressif32 @ ^6.4.0
board = esp32-s2-saola-1
framework = arduino
monitor_speed = 115200
; Upload speed: Very slow for maximum reliability
upload_speed = 57600

; Library Dependencies
lib_deps =
    https://github.com/schreibfaul1/ESP32-audioI2S.git#2.0.6
    adafruit/Adafruit NeoPixel @ ^1.15.0
    ; Built-in USBMSC used instead of Adafruit TinyUSB to avoid conflicts

; Hardware & Build Configurations for ESP32-S2
build_flags = 
    ; ESP32-S2 uses USB OTG (Mode 0)
    -D ARDUINO_USB_MODE=0
    ; -D USE_TINYUSB ; Disabled to use native USBMSC
    ; Serial on UART (so you can monitor on usbserial-1130, same cable as upload)
    -D ARDUINO_USB_CDC_ON_BOOT=0
    ; Pin definitions (can be overridden in BoardConfig.h)
    -D I2S_DOUT=6
    -D I2S_BCLK=4
    -D I2S_LRC=5
    -D LED_COUNT=1
    -std=gnu++2a
    -D CORE_DEBUG_LEVEL=3
    -I "${platformio.packages_dir}/framework-arduinoespressif32/libraries/WiFiClientSecure/src"

[env:esp32-s3-devkitc-1]
; Build: pio run  (if pio not found, see docs/USE_PIO_DIRECTLY.md)
; Use standard Espressif32 platform (Arduino 2.x / IDF 4.4)
platform = espressif32 @ ^6.4.0
board = esp32-s3-devkitc-1
framework = arduino

; Serial Monitor speed
monitor_speed = 115200

; Library Dependencies
lib_deps =
    # Core Audio: High-performance I2S decoding for MP3/WAV
    https://github.com/schreibfaul1/ESP32-audioI2S.git#2.0.6
    
    # LED Control: Latest 1.15.x for stable S3 RMT timing
    adafruit/Adafruit NeoPixel @ ^1.15.0
    
    # USB Stack: Version 3.7.x is required for stable MSC on ESP32-S3
    adafruit/Adafruit TinyUSB Library @ ^3.7.0

; Hardware & Build Configurations
build_flags = 
    # Enable High Speed USB (Native S3 feature)
    -D ARDUINO_USB_MODE=1
    # Use TinyUSB as the underlying stack for MSC/CDC
    -D USE_TINYUSB
    # Enable Serial Debugging through Native USB port
    -D ARDUINO_USB_CDC_ON_BOOT=1
    # Define standard audio pins to simplify code management
    -D I2S_DOUT=47
    -D I2S_BCLK=46
    -D I2S_LRC=45
    # Use C++20 dialect supported by ESP32 toolchain
    -std=gnu++2a
    # Set debug level (0=None, 1=Error, 2=Warn, 3=Info, 4=Debug, 5=Verbose)
    -D CORE_DEBUG_LEVEL=3
    # WiFiClientSecure path (needed by include/NetworkClientSecure.h when framework is 2.x)
    -I "${platformio.packages_dir}/framework-arduinoespressif32/libraries/WiFiClientSecure/src"

; Partition Scheme: Use a large app partition to accommodate the libraries
board_build.partitions = default_16MB.csv